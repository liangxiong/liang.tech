# B+树索引

## 聚集所以 record_type = 1目录项记录
- 主键索引：
  - 只有主键值 和 页的编号两个列
  - 主键最小值记录的 min_rec_mask: 1 其他都未0

- 多级目录项记录 形成 B+树
- 假设一页16K 能存放 1000条目录项记录
  - 1层：100条用户记录节点
  - 2层：1000 * 100  = 10w
  - 3层：1000 * 100 * 100  = 1亿
  - 4层：1000 * 100 * 100 * 100  = 100亿
- 所以一般数据都在1亿内，通过3个目录项页和一个用户记录页 查询到

- 特点
  - 使用记录主键值的大小进行记录和页的排序
    - 页内的记录是按照主键的大小顺序排成一个单向链表
    - 存放用户记录的页 根据用户记录的主键大小顺序排成一个双向链表
    - 存放目录项记录的页分为不同的层次，在同一层次中的页也是根据页中目录项记录的主键大小顺序排成一个双向链表

  - B+树的叶子节点存储了所有列的值


## 二级索引
- 比如 我是按 c2字段建立索引
- 特点：
  - 页内的记录是按照c2列的顺序排成一个单向链表
  - 存放用户记录的页 根据页中记录的c2列顺序排成一个双向链表
  - 存放目录项记录的页分为不同的层次，在同一层次中的页也是根据页中目录项记录的 c2 大小顺序排成一个双向链表
  - 叶子节点存储的并不是完整的用户记录，而是c2列 + 主键这两个列的值
  - 目录项记录中不再是主键+页号的搭配，而变成了c2列 + 页号的搭配

- 查询过程：
  - 根据 根页面，通过二分查询，快速定位到目录项记录所在的页
  - 由于没有唯一约束，根据记录页，遍历后续的记录，拿到 主键
  - 回表：根据上面查询到的主键 再到聚族索引中查一遍

- 存储：
  - 目录中存放了：c2, 主键, 页号

## 联合索引
- 比如 我们是按 c2 , c3建立索引
- 先按 c2 排序，c2相同按c3排序

## 索引共同点
- 流程
  - 根页面 永久不动，他是数据字典的内容
  - 刚开始的数据插入，根页面指向 叶子节点用户数据
  - 随着数据增多，根节点使用空间用完，开始页分裂，索引数据移到新叶，而根节点升级为存储目录项的页

## MyIsam
- 用户记录的数据文件 和 索引分开存储
- 用户记录按插入先后顺序 存储到数据文件中
- 主键是一个索引，存储的是：主键 + 行号
- 二级索引存储的是： 相应的列 + 行号

### MyIsam 行格式：
- 类型：
  - 定长记录格式（Static）占用存储空间的大小是固定
  - 变长记录格式（Dynamic）
  - 压缩记录格式（Compressed）
