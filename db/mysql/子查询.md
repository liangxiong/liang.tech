# 子查询

- 物化表的提出

- 标量子查询
- 行子查询


- IN (a, b, c ..., ...); in 太多
  - 不直接将不相关子查询的结果集当作外层查询的参数，而是将该结果集写入一个临时表里
  - 该临时表的列就是子查询结果集中的列
  - 写入临时表的记录会被去重
  - 它建立基于内存的使用Memory存储引擎的临时表，而且会为该表建立哈希索引。
  - 如果子查询的结果集非常大，超过了系统变量tmp_table_size或者max_heap_table_size，临时表会转而使用基于磁盘的存储引擎来保存结果集中的记录，索引类型也对应转变为B+树索引。

  - 将子查询结果集中的记录保存到临时表的过程称之为物化（英文名：Materialize）
    - 基于内存的物化表有哈希索引，基于磁盘的有B+树索引

- 优化：
  - 转化成内连接，考虑不同驱动表的成本

-  半连接（英文名：semi-join）
  - 对于驱动表的某条记录来说，我们只关心在被驱动表中是否存在与之匹配的记录，而不关心具体有多少条记录与之匹配，最终的结果集中只保留驱动表的记录
  - Table pullout （子查询中的表上拉）：子查询的查询列表处只有主键或者唯一索引列
  - DuplicateWeedout execution strategy （重复值消除）
    - 消除semi-join结果集中的重复值的方式
  - LooseScan execution strategy （松散扫描）

  - Semi-join Materialization execution strategy

  - FirstMatch execution strategy （首次匹配）

  - 适用条件：
    - 该子查询必须是和IN语句组成的布尔表达式，并且在外层查询的WHERE或者ON子句中出现。
    - 外层查询也可以有其他的搜索条件，只不过和IN子查询的搜索条件必须使用AND连接起来。
    - 该子查询必须是一个单一的查询，不能是由若干查询由UNION连接起来的形式。
    - 该子查询不能包含GROUP BY或者HAVING语句或者聚集函数
