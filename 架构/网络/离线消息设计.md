# 离线消息设计

#### 总结
- 应用层的ack是可达性的保障
- 群消息只存储一份，为每个用户存储最近的群消息ack id
- 可批量ack id
- 客户端去重msg_id
- 离线消息过多，可分页拉取

## 设计3： 记录last_ack_msg_id
- 群消息表
- 群用户关系表增加 last_ack_msg_id
  - 每次拉取 > last_ack_msg_id
  - 消息ack的压力大



### 批量ack或间隔ack
- 每收到N条消息ACK一次
- 每隔时间ACK一次

##  设计1： 每个消息每个用户都存储一份
- 用户表
- 群成员表
- 群离线消息表 （每一个用户都存储离线消息）
  - 造成db压力很大，每个消息每个用户都存储一份

## 设计2：离线消息，我只存储消息id
- 群消息表
- 群离线消息表  
  - 存储消息的id
  - 客户端先拉取离线的消息id，再根据id拿到消息明细
  - 离线消息还存在
