# mysql 配置

## 启动：
- mysqld：MySQL服务器程序
- mysqld_safe：是一个启动脚本
  - 间接的调用mysqld
  - 而且还启动了另外一个监控进程
  - 监控进程在服务器进程挂了的时候，可以帮助重启它

- mysql.server 是一个启动脚本
  - 会间接的调用mysqld_safe
  - 调用mysql.server时在后边指定start参数就可以启动服务器程序了
    - mysql.server start

- mysqld_multi
  - 运行多个服务器实例

## 连接：
- TCP/IP
- Unix域套接字文件
  - 服务端启动： mysqld --socket=/tmp/a.txt
  - 客户端连接： mysql -hlocalhost -uroot --socket=/tmp/a.txt -p

## 配置
- 配置文件 优先级越后面越高
  - /etc/my.cnf
  - /etc/mysql/my.cnf
  - SYSCONFDIR/my.cnf
  - $MYSQL_HOME/my.cnf	特定于服务器的选项（仅限服务器）
  - defaults-extra-file	命令行指定的额外配置文件路径
  - ~/.my.cnf	用户特定选项
  - ~/.mylogin.cnf	用户特定的登录路径选项（仅限客户端）使用 mysql_config_editor 生成

- 配置内容：每个组有组名，用中括号[]扩起来

```
[server]
(具体的启动选项...)

[mysqld]
(具体的启动选项...)

[mysqld-5.7]
# 特定版本号的启动项

[mysqld_safe]
(具体的启动选项...)

[client]
(具体的启动选项...)

[mysql]
(具体的启动选项...)

[mysqladmin]
(具体的启动选项...)
```

启动命令      | 类别        |  能读取的组  
-------------|------------|----------
mysqld       | 启动服务器	 | [mysqld]、[server] |
mysqld_safe  | 启动服务器	 | [mysqld]、[server]、[mysqld_safe] |
mysql.server | 启动服务器	 | [mysqld]、[server]、[mysql.server]|
mysql        | 启动客户端   | [mysql]、[client]                 |
mysqladmin   | 启动客户端	 | [mysqladmin]、[client]            |
mysqldump    | 启动客户端	 | [mysqldump]、[client]             |

## 变量
### 系统变量：
- 提示：
  - 如果启动选项名由多个单词组成，各个单词之间用短划线-或者下划线_连接起来都可以
  - 它对应的系统变量的单词之间必须使用下划线_连接起来

- 设置变量，区分不同作用域范围：
  - 客户端私有变量 SESSION LOCAL  
    - SET [GLOBAL|SESSION] 系统变量名 = 值; SET SESSION default_storage_engine = MyISAM; SET default_storage_engine = MyISAM;
  - 服务端全局变量 GLOBAL
    - SET [@@(GLOBAL|SESSION).]var_name = XXX;

- 查看变量
  - SHOW [GLOBAL|SESSION] VARIABLES [LIKE 匹配的模式];

- 注意：
  - 有些系统变量是具有GLOBAL和SESSION的作用范围，而有的是没有
  - 有些系统变量是只读的，并不能设置值

### 状态变量
- 程序运行状态的变量
- 有GLOBAL | SESSION 2个作用范围
- 查看：SHOW STATUS LIKE 'thread%';

# 数据目录
- 查看存储目录地址：SHOW VARIABLES LIKE 'datadir';
- 文件结构: /var/lib/mysql/database/
  - /var/lib/mysql/database/db.opt
    - 字符集和比较规则

## InnoDB
- 文件：
  - table.frm: 表结构
  - table.ibd: 索引和数据文件

- 页
  - "页" 为基本单位来管理存储空间，默认：16KB
  - 每个索引 对应 一颗 B+树，每个节点都是一个数据页
  - 数据页之间不必是物理连续，数据页之间有双向链表来页的顺序
  - 聚集索引：叶子节点存储了完整的数据

- 表空间
  - 系统表空间（system tablespace）
    - 5.5.7 ~ 5.6.6之间的版本，表中的数据都会存储到这个系统表空间
    - ibdata1 大小12MB，自扩展文件
    - 修改文件名称：innodb_data_file_path=data1:512M;data2:512M:autoextend
      - autoextend 表明文件如果不够用，会自动扩展data2文件的大小

  - 独立表空间(file-per-table tablespace)
    - 大于 5.6.6 每个表建立一个独立表空间
    - 在该表所属数据库对应的子目录下创建独立表空间的文件
      - table_name.ibd: 索引和数据文件
      - table_name.frm: 表结构
    - 降级回 表的数据存储回 系统表空间
      - 参数： innodb_file_per_table=0
        - 0: 使用系统表空间
        - 1: 使用独立表空间
      - 把已经存在系统表空间中的表转移到独立表空间:
        - ALTER TABLE 表名 TABLESPACE [=] innodb_file_per_table;
      - 把test表从独立表空间移动到系统表空间:
        - ALTER TABLE 表名 TABLESPACE [=] innodb_system;

  - 其他类型的表空间
    - 通用表空间（general tablespace）
    - undo表空间（undo tablespace）
    - 临时表空间（temporary tablespace）

## MyISAM
- 文件：
  - frm: 表结构
  - myd: 表数据文件
  - myi: 表索引文件

- 都是非聚集索引，二级索引

## 视图：
- 是虚拟的表，是某个查询语句的一个别名
- 只需要把它的结构存储起来就行了
- 它的结构存储成: 视图名.frm, 内容: 明文存储sql结构

## 其他文件：
- PID进程文件

- 日志文件
  - 查询日志
  - 错误日志
  - 二进制日志
  - redo日志

- 证书文件：
  - SSL
  - RSA证书和秘钥

## 文件系统：
- 数据库名称和表名称不得超过文件系统所允许的最大长度
- 表名如果存在特殊字符，映射成编码值
- 文件长度受文件系统最大长度限制


## 核心库
- mysql
  - 用户账户
  - 权限信息
  - 存储过程、事件的定义信息，运行过程中产生的日志信息，一些帮助信息以及时区信息等

- information_schema: 元数据库
  - 所有其他数据库的信息
  - 哪些表、哪些视图、哪些触发器、哪些列、哪些索引

- performance_schema
  - 运行过程中的一些状态信息，是一个性能监控
  - 包括统计最近执行了哪些语句，在执行过程的每个阶段都花费了多长时间，内存的使用情况等信息。

- sys
  - 主要是通过视图的形式把information_schema和performance_schema结合起来，更方便的了解MySQL服务器的一些性能信息
