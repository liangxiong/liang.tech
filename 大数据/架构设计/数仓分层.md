https://help.aliyun.com/document_detail/102614.html?spm=a2c4g.11186623.6.1065.5f361099iJFZZh

https://help.aliyun.com/document_detail/117432.html?spm=a2c4g.11186623.6.893.18d349a0WA8zfZ


https://zhuanlan.zhihu.com/p/27426819
https://help.aliyun.com/document_detail/117432.html?spm=a2c4g.11186623.6.893.35b36a11kIm3rz

https://mp.weixin.qq.com/s/JiiBquhso1_guFvryHxE5g


入 ODS 层，DWD 层 对商品分类表进行维度退化？


## 基本名词解释
- OLAP
- OLTP
- ETL: 抽取、洗净、传输


- 事实表：发生在现实世界中的操作型事件
  - 如：电商购买的行为是一个事件：订单表
    - 事实表

- 维度表：
  - 每个维度表都包含单一的主键列
  - 维度表的主键可以作为与之关联的任何事实表的外键
  - 维度表行的描述环境应与事实表行完全对应。 维度表通常比较宽，是扁平型非规范表，包含大量的低粒度的文本属性
  - 如：用户表、商家表、时间表

- 面向主题的:

- 拉链表：

- 增量表：

## 分层：
### ods：Operational Data Store 原始数据层
- 作用：
  - 在结构上与源系统的增量或者全量数据基本保持一致
  - 相当于数据准备区
  - 承担着基础数据的记录以及历史变化
  - 主要作用是把基础数据引入到数仓
- 处理：
  - 去噪，去重，提脏
  - 单位统一，砍字段
- 工具：
  - 数据库：
    - 定时：datax，sqoop
    - 实时：canal 监听 mysql的 binlog
  - 埋点日志
    - flume抽取 -> kafka -> spark streaming, storm, flink 实时接入计算

### cdm: Common Data Model 公共维度模型层
- 作用：
  - 完成数据加工与整合
  - 建立一致性的维度
  - 构建可复用的面向分析和统计的明细事实表以及汇总公共粒度的指标

#### dwd: Data Warehouse Detail 明细数据层
- 包含大量的行, 解决质量，完整度问题
- 作用：
  - 以业务过程为建模驱动
  - 基于每个具体业务过程的特点，构建最细粒度的明细层事实表
  - 宽表化处理
  - 标准化，维度补全，异常处理

- 宽表数据冗余，应该遵循以下建议准则：
  - 冗余字段与表中其它字段高频率（大于3个下游应用SQL）同时访问
  - 冗余字段的引入不应造成其本身的刷新完成时间产生过多后延
  - 公共层数据不允许字段重复率大于60%的相同粒度数据表冗余，可以选择在原表基础上拓宽或者在下游应用中通过JOIN方式实现

- 分类：
  - 事务事实表
    - 保存的是最原子的数据，也称“原子事实表”
    - 日期记录的是事务发生的日期
  - 周期快照事实表
    - 每个时间段一条记录
  - 累积快照事实表

- 如：
  - ods 中只有id，到dwd 补充了name等信息


#### dim：Dimension Table，公共维度层
- 作用：
  - 基于维度建模理念思想，建立企业的一致性维度
  - 降低数据计算口径和算法不统一风险

- 如：
  - 渠道，年龄段，类目，区域 等等公共维度

- 允许以一个统计周期单元作为原子拆分，即一个统计周期拆分一个表

- 命名：
  - dim_{业务板块名称/pub}_{维度定义}[_{自定义命名标签}]


#### dws: Data Warehouse Summary 汇总数据层
- 如何操作：
  - 以分析的主题对象作为建模驱动
  - 基于上层的应用和产品的指标需求，构建公共粒度的汇总指标事实表
  - 以宽表化手段来物理化模型
  - 希望80%的业务都能通过我们的DWS层计算，而不是ODS

- 分2类指标：
  - 非累计的度量值 如：uv
  - 可累计的度量值 如：pv

- 作用：
  - 提升公共指标的复用
  - 数据单业务组装统计

#### dwm Data Warhouse Market 数据集市层
- 主题域：汇总数据宽表集市
- 跨业务场景
- 数据组装统计

### ads: Application Data Service 应用层
- 主题  明细查询和指标计算

- 存储：
  - mysql，es，hbase，redis


## 数据流向：


## 命名
- 表命名
  - dwd_xxx
  - 仓库分层
  - 按业务域 | 子公司 | 产品线
  - 按数据域
  - 按业务过程：
  - 时间周期

- 字段命名
  - amt：费用
  - cnt：技术字段
  - rate：比例
  - time：时间字段
  - date：日期字段
  - is_xx：标识

- 分区：
  - ds：年月日
  - hh：小时
  - mm：分钟


## 模型设计的基本原则
- 高内聚和低耦合
- 核心模型与扩展模型分离
- 公共处理逻辑下沉及单一
- 成本与性能平衡
- 数据可回滚
- 一致性
- 命名清晰可理解


## 数据质量监控
- 校验配置解析

- 数据源监控

- 数据校验

- 异常报警

- 质量报告


## 元数据规范管理
- 命名机制
  - 词根：数量业务 常用维度和指标含义
  - 字段：
    - 必须使用词根库里的词，来构造字段，保证不同表中同一含义的字段命名一致

  - 数据表：根据主题统一命名数据表名

- 规范：
  - 审核机制
  - 追责机制
  - 一致性保证

## 数仓建设规范
- 前缀：
  - t: 表
  - v: 视图
  - f 表示事实数据
  - d 表示维度数据
  - s 表示快照数据

- 字段命名规范： 使用小写字母，字母间用下划线

- 字段使用 命名库中获取，禁用保留字

- 元数据字段必须从词根库中组合获取

## 参考：
- [阿里云数仓分层](https://help.aliyun.com/document_detail/114447.html)
