# 缓存常见问题

### 缓存穿透
```
    一般操作：如果不存在就直接查询数据库然后再缓存查询结果返回。如果我们查询的数据在缓存中一直不存在，

就会造成每一次请求都查询DB，这样缓存就失去了意义，在流量大时，可能DB就挂掉了。

可以将这个不存在的key预先设定一个值。    然后应用通过判断预设值，判断是否继续。

```

### 缓存并发
```

         如果并发高，一个缓存如果失效，可能出现多个进程同时查询DB，同时设置缓存的情况，如果并发确实很大，

这也可能造成DB压力过大，还有缓存频繁更新的问题。

    对缓存查询加锁，如果KEY不存在，就加锁，然后查DB入缓存，然后解锁；其他进程如果发现有锁就等待，然后等解锁后返回数据或者进入DB查询。

```



### 缓存失效

```

    高并发的时候，平时我们设定一个缓存的过期时间时，会设置一些固定值，可能会出在某一个时间同时生成很多缓存，

并且过期时间都一样，这个时候就可能引发一当过期时间到后，这些缓存同时失效，请求全部转发到DB，DB可能会压力过重。

    缓存失效时间分散开，比如我们可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，

这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。

```



###常见问题
- 缓存和DB不一致问题
```
    修改数据成功，通知缓存失效失败，可以通过异步任务
```



- 主动重新加载缓存
```
    双key设计，附属key，记录失效的时间，异步任务，判断失效的时间，主动重新加载缓存，操作上有一定的复杂度。
```

- [参考](http://www.jianshu.com/p/2cd6ad416a5a)
