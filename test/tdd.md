### what:
- TDD： Test-Driven Development，先写测试用例，再开发
- 通过测试用例来 整理需求，规范约束编写出质量更高，bug 更少的代码
    - 基于需求，需要有哪些用例来测试，
    - 想好了怎么测试，再动手写代码 开发
- 通过测试来推动开发的进行。在开发阶段，就是结果往后推的过程。

<img src = 'http://res.liang3307.tech/liang.tech/test/res/tdd.png'>
<br />

- 扩展相关思想：
    - BDD：行为驱动开发，侧重设计
        - 通过自然语言书写，非程序员可读的测试用例，扩展了测试驱动开发方法
    - XP：极限编程提出的思路就是小步前进。把所有的规模大、复杂性高的工作，分解成小的任务来完成。通过分解，降低系统的复杂度

- 从软件开发的阶段对比：
    - 计划
    - 需求分析 <--> 验收测试
    - 概要设计 <--> 系统测试
    - 详细设计 <--> 集成测试
    - 编码 <--> 单元测试
    - 软件测试 <--> 集成/系统测试
    - 运行维护

### why:
- 对于需求
    - 产品功能需求：
    - 代码的可维护性也是非功能性需求
        - 开发会害怕：后期修改某个类，接口。改了我都忘了有哪些case
        - leader怕：开发又要说重构了，你怎么经常重构呀？重构的质量怎么保证，又要这么多时间重构。换种做法：重构在不知不觉间做完了

- 对于开发同学：开发过程，决定着开发是痛苦的挣扎，还是不断进步的喜悦
    - 需求：
        - 编写测试用例，可以帮助自己理解和细化需求，分解问题，逐个覆盖解决，步步为营
    - 设计：
        - 测试驱动是对开发的限制，测试用例写的好，设计就不会太差，模块的耦合就不会太强，BUG就不会太多。
        - 引导设计合理的功能粒度和易测的外部模块接口
        - 通过编写测试用例，考虑代码的使用需求（包括功能、过程、接口），而且这个描述是无二义的，可执行验证的。
    - 开发：
        - 用测试用例替代调试，完成功能或修复bug也完成了回归
        - 提高开发效率，减少基本逻辑错误，减少返工，把精力放在关联的交互上。结硬寨（写测试用例），打呆仗（开发）；扎实，少犯错
    - 维护
        - 测试用例即文档，要看接口文档，直接看测试的api调用。
        - 对编写文档厌烦，但要使用、理解别人的代码时又希望有文档指导。而测试用例就是对代码,业务的的解释。所以：测试同学也可以说是很懂业务的
    - 重构
        - 修改代码会比较有保障，很容易回归

- 对于测试同学：我还没遇到过白盒测试，测试开发
    - 功能测试
        - 系统或集成测试不容易覆盖代码细节，难以做到很高的代码覆盖率，做到了正常业务的覆盖率
    - 添加测试用例或者回归，周期太长，环境会更复杂，反馈不及时，容易互相推诿。
        - 每次聚焦一个细粒度问题，单元测试通过表示问题解决，开发形成自反馈  
    - 如果团队太大或变更频繁，会回归不及时，造成功能被破坏或者修复的BUG重现
    - 即使系统或集成测试发现问题，也很难聚焦和定位问题。
        - 单元测试只覆盖一个情景，一旦测试失败，几乎不需要调试就知道问题出在什么地方，当然看你写的测试用例足够的细

### how:
- 周期：测试用例 -> 开发 -> 单元测试 -> 重构 -> 单元测试

- 单元测试的粒度：
    - 只写恰好能够体现一个失败情况的单元测试代码
    - 只写能够使一个失败的单元测试通过的产品代码
    - 运用你的经验，认为需要编写的用例进行测试
    - 如果出现bug，补充用例
    - 对可能出问题的地方进行重点测试

- 执行：
    - 明确要完成的功能
    - 定义接口
    - 编写测试用例
    - 完成功能开发
    - 测试通过
    - 循环完成所有功能开发
    - 对代码进行重构，保证原有用例测试通过
    - 测试隔离：不同代码的测试应该相互隔离。对一块代码的测试只考虑此代码的测试，不要考虑其实现细节。
    - 注意：
        - 测试隔离：不同模块的用例相互隔离。对一块代码的测试只考虑此代码的测试，不要考虑其实现细节。
        - 软件开发过程的侧重点有不同：需求，架构，设计，开发，测试，运营，重构 相应承担不同角色。注意力要集中当下工作中，不要考虑其他方面的细节，导致增加复杂性。

- 原则
    - 操作过程尽量模拟正常使用的过程
    - 测试数据要简单，容易理解。尽量包括：真实数据，边界数据。
    - 全面的测试用例，尽量做到分支覆盖，核心代码尽量做到路径覆盖
        - 语句覆盖：所有语句都执行一遍，A=true B=true C=true
        - 分支覆盖： 判断真假分支都执行一遍
        - 条件覆盖：要使得每个判断中的每个条件的可能取值至少满足一次
        - 路径覆盖：要求覆盖程序中所有可能的路径
        - 代码：
```
if A and B then
    Action1
if C or D then
    Action2
```

- 训练：
    - fastjson 有：2397个单元测试类，你和开源作者 p7 的差距

    - 语音sdk 承担部分功能
        - ask 语义理解接口：测试case:
            - 接口是否联通
            - 联通的性能 耗时是多少?
            - 各种意图和关键字段是否正确
                - 我要买西瓜 ： 是否返回了  意图是商品搜索，查询关键字是：西瓜

    - 报表结果：


### 目标效果：
- 代码可测试性
- 代码可重构

### todo:
- 梳理好 tvtao，tvtaos，tvtaoadmin 的单元测试
- 用例谁来写：对交付结果，业务和产品 熟悉，理解深刻的人。开发自己写

### 参考：
https://en.wikipedia.org/wiki/Test-driven_development
https://www.atajtnw.org/articles/98850
