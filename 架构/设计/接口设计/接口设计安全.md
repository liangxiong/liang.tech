# 接口安全 token设计：

## 名称解释：
- Api Token: 接口令牌
  - 标识接口应用调用者的身份

- User Token: 用户登录后的session Token
  - 用于访问需要登录之后的接口 如：用户信息


## 应用流程
- 线下申请应用：
  - 提供方会给接口调用方 appId，secret

- 非登录接口调用流程：
  - 客户端携带通用参数，去调用服务器端，获取API token
    - appid
    - timestamp
    - sign：加密(appId + timestamp + key)
  - 客户端拿着api token,去访问不需要登录就能访问的接口

- 用户接口调用流程：
  - 客户端跳转到登录页面，通过用户名和密码调用登录接口，会返回一个usertoken
  - 客户端拿着usertoken，去访问需要登录才能访问的接口

## 接口通用参数：可放在http协议头
- appId：应用名
- timestamp：是客户端调用接口时对应的当前时间戳
  - 作用：用于防止重复攻击
    - 每次调用接口时都会判断服务器当前系统时间和接口中传的的timestamp的差值
    - 如果这个差值超过某个设置的时间(假如5分钟)，那么这个请求将被拦截掉
    - 如果在设置的超时时间范围内，是不能阻止DoS攻击的
    - 能减轻DoS攻击的时间，缩短攻击时间

- sign：加密(timestamp + key)
  - 过程：
    - 将所有非空参数按照升续排序 + token + key + timestamp + nonce(随机数) 拼接在一起
    - 使用某种加密算法进行加密，作为接口中的一个参数sign来传递
      - md5
      - aes

- nonce: 随机值，是客户端随机生成的值，作为参数传递过来，随机值的目的是增加sign签名的多变性


### 注意：
- 接口使用https 协议
  - 解决：从客户端出口到服务端接受中间过程遇到 运营商，网络设备等等传输的安全性  

- Token的时效性：token可以是一次性的、也可以在一段时间范围内是有效的

- timestamp: 时间戳，是客户端调用接口时对应的当前时间戳，时间戳可用于防止DoS攻击
  - 这个差值超过某个设置的时间(假如5分钟)，那么这个请求将被拦截掉
  - 注意客户端的时间校验
