# 数据库中间件设计方案

## 三种设计方式

### 数据库代理
- 简介：
  - 独立部署代理服务，这个代理服务背后管理多个数据库实例。
  - 应用层，通过一个普通的数据源(c3p0、druid、dbcp等)与代理服务器建立连接
  - sql语句都是发送给这个代理，由代理去操作底层数据库，得到结果并返回给应用。
  - 分库分表和读写分离的逻辑对开发人员是完全透明的
- 样例：
  - [mycat 还维护](https://github.com/MyCATApache/Mycat-Server.git)
  - 没人维护：cobar，，mysql-proxy，atlas

- 优点：
  - 多语言支持，需要实现了mysql协议，

- 缺点：
  - 由于实现了mysql协议，实现复杂，难度较大

### JDBC 数据源代理
- 简介：
  - 伪装成特定的数据源，代理内部管理的多个普通的数据源(c3p0、druid、dbcp等)，
    - 每个普通数据源各自与不同的库建立连接。
  - 应用层产生的sql交给数据源代理进行处理，对sql进行必要的操作
    - 如sql改写等，交给各个普通的数据源去执行，
    - 将得到的结果进行合并，返回给应用
  - 数据源代理通常也实现了JDBC规范定义的API，因此能够直接与orm框架整合
  - 应用层代码需要修改成使用代理的数据源，而不是直接使用c3p0、druid、dbcp的普通连接池
- 样例：tddl，zebra，sharding-jdbc

- 优点：
  - 轻量，底层只管理普通的数据源

- 缺点：
  - 升级相对麻烦，要通知各个业务方

### ORM框架代理
- 样列：hibernate-shards, mybatis 插件
